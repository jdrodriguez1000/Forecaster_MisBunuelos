# =============================================================================
# CONFIGURATION FILE: Pronóstico Buñuelos "Mis Buñuelos"
# =============================================================================

project:
  name: "Forecaster Mis Bunuelos"
  description: "Sales forecasting model for the next 6 months"
  language: en  # Code & Folders
  context: es   # Rules & Business logic
  random_state: 42
  target_column: "total_unidades_entregadas"

# -----------------------------------------------------------------------------
# INFRASTRUCTURE & PATHS
# -----------------------------------------------------------------------------
paths:
  data:
    base: data/
    raw: data/01_raw/
    cleansed: data/02_cleansed/
    features: data/03_features/
    processed: data/04_processed/
  
  # Segregación Lab (Experiments)
  lab:
    base: experiments/
    # Phase specific artifact paths are constructed dynamically in code: experiments/phase_XX/artifacts|figures
  
  # Segregación Prod (Outputs)
  prod:
    base: outputs/
    reports: outputs/reports/
    figures: outputs/figures/
    models: outputs/models/
    forecasts: outputs/forecasts/
    metrics: outputs/metrics/

# -----------------------------------------------------------------------------
# DATA PARAMETERS
# -----------------------------------------------------------------------------
data:
  target_column: "total_unidades_entregadas"
  date_column: "fecha"
  full_update: false
  min_history_months: 36
  source_tables:
    - "ventas_diarias"
    - "redes_sociales"
    - "promocion_diaria"
    - "macro_economia"

# -----------------------------------------------------------------------------
# DATA SCIENCE PARAMETERS
# -----------------------------------------------------------------------------
validation:
  min_months_required: 36
  test_size_months: 12
  val_size_months: 12
  horizon_months: 6
  backtest_refit: false  # Rolling window strategy (ForecasterDirect refit is usually false for speed unless required)

forecasting:
  engine: skforecast
  forecaster_type: ForecasterDirect
  lags: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]  # 1-12 months lags
  models:
    - Ridge
    - RandomForestRegressor
    - LGBMRegressor
    - XGBRegressor
    - GradientBoostingRegressor
    - HistGradientBoostingRegressor

# -----------------------------------------------------------------------------
# DOMAIN EXPERT RULES (Business Logic)
# -----------------------------------------------------------------------------
business_events:
  novenas:
    start_day: 16
    end_day: 23 # Adjusted to 23 based on expert rules (16-23)
    month: 12
  primas:
    months: [6, 12]
    day_range: [15, 20] # Range 15-20
  promotions:
    windows: [[4, 5], [9, 10]] # [[April, May], [Sep, Oct]]
  peak_days:
    days: ["Saturday", "Sunday"]
    holidays_as: "Saturday"
  macro_projection:
    method: MA
    window_size: 2  # Promedio Móvil Recursivo de 2 meses

# -----------------------------------------------------------------------------
# DATA QUALITY (Discovery & Audit)
# -----------------------------------------------------------------------------
quality:
  sentinel_values:
    numeric: [-1, 999, 9999]
    categorical: ["UNKNOWN", "N/A", "NULL", ""]
    datetime: ["1900-01-01", "2099-12-31"]
    boolean: []
  imputation_strategy: interpolate # linear, mean, median
  high_cardinality_threshold: 0.9 # Ratio unique/total > 0.9 implies potential ID column or high cardinality
  zero_presence_threshold: 0.3 # Ratio of zeros > 0.3 implies high presence of zeros

# -----------------------------------------------------------------------------
# DATA CONTRACT (Schema Validation)
# -----------------------------------------------------------------------------
data_contract:
  ventas_diarias:
    fecha: datetime
    total_unidades_entregadas: int
    unidades_precio_normal: int
    unidades_promo_pagadas: int
    unidades_promo_bonificadas: int
    precio_unitario_full: float
    costo_unitario: float
    ingresos_totales: float
    costo_total: float
    utilidad: float
  macro_economia:
    fecha: datetime
    ipc_mensual: float
    trm_promedio: float
    tasa_desempleo: float
    costo_insumos_index: float
    confianza_consumidor: float
  promocion_diaria:
    fecha: datetime
    es_promo: int
  redes_sociales:
    fecha: datetime
    ciclo: object
    inversion_facebook: float
    inversion_instagram: float
    inversion_total: float

# -----------------------------------------------------------------------------
# FINANCIAL HEALTH (Strict Business Rules)
# -----------------------------------------------------------------------------
financial_health:
  target_files:
    - ventas_diarias

# -----------------------------------------------------------------------------
# PREPROCESSING (Phase 2)
# -----------------------------------------------------------------------------
preprocessing:
  frequency: "MS"  # Month Start
  data_frequency:
    ventas_diarias: "D"
    redes_sociales: "D"
    promocion_diaria: "D"
    macro_economia: "MS"
  
  # Mapa de Renombramiento (Sanitización)
  rename_map:
    # "columna_origen": "columna_destino" (Vacío si ya coinciden)

  # Filtrado de Ruido
  filters:
    exclude_ids: [999]
    min_date: "2018-01-01"

  # Lógica de Recálculo Financiero (Corrección Costos Fase 1)
  recalc_financials: true 

  # Reglas de Agregación Mensual
  aggregation_rules:
    # Ventas
    total_unidades_entregadas: "sum"
    unidades_precio_normal: "sum"
    unidades_promo_pagadas: "sum"
    unidades_promo_bonificadas: "sum" # Días en promo
    ingresos_totales: "sum" # Se recalculara antes si recalc_financials=true
    costo_total: "sum"      # Se recalculara antes si recalc_financials=true
    utilidad: "sum"         # Se recalculara antes si recalc_financials=true
    precio_unitario_full: "mean"
    costo_unitario: "mean"
    
    # Marketing
    inversion_facebook: "sum"
    inversion_instagram: "sum"
    inversion_total: "sum"
    
    # Promos
    es_promo: "sum" # Días en promo
    
    # Macros
    ipc_mensual: "first"
    trm_promedio: "first"
    tasa_desempleo: "first"
    costo_insumos_index: "first"
    confianza_consumidor: "first"
